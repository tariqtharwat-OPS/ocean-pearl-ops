# WEEKLY_SIMULATION_ACCEPTANCE_REPORT_ADDENDUM.md

## 1) Transaction Documents (Raw)

### transactions/yYCZVVQ7SNmugle7qS2X
```json
{
  "type": "PURCHASE_RECEIVE",
  "locationId": "kaimana",
  "unitId": "gudang_ikan_teri",
  "itemId": "teri_grade_a",
  "quantityKg": 500,
  "pricePerKg": 10000,
  "paymentMethod": "cash",
  "description": "Sim Day 1 RCV",
  "totalAmount": 5000000,
  "serialNumber": "RCV-KAI-26-0033",
  "timestamp": "2026-02-02T22:20:59.493Z",
  "serverTimestamp": "2026-02-02T22:20:59.493Z",
  "userId": "SYSTEM",
  "finalized": true,
  "skipAudit": false,
  "ai_risk_score": 1,
  "risk_score": 1,
  "auditStatus": "CLEARED",
  "ai_analysis": "Transaction appears standard. Purchase price of 10,000 IDR/kg for Teri Grade A is within healthy market parameters. Total expenditure (5,000,000 IDR) hits the exact ceiling of the auto-approval limit without exceeding it. Cash payment is well below the 10M IDR suspicious threshold."
}
```

### transactions/YG1BrpN8H7u7xWV2uwkK
```json
{
  "type": "COLD_STORAGE_IN",
  "locationId": "kaimana",
  "unitId": "gudang_ikan_teri",
  "itemId": "teri_grade_a",
  "quantityKg": 150,
  "rawUsedKg": 500,
  "description": "Sim Day 2 PRD",
  "totalAmount": 0,
  "serialNumber": "PRD-KAI-26-0003",
  "timestamp": "2026-02-02T22:21:01.854Z",
  "serverTimestamp": "2026-02-02T22:21:01.854Z",
  "userId": "SYSTEM",
  "finalized": true,
  "skipAudit": false,
  "ai_risk_score": 9,
  "risk_score": 9,
  "auditStatus": "FLAGGED",
  "ai_analysis": "CRITICAL YIELD VIOLATION. The production yield for this batch is 30% (150kg output / 500kg raw input). This is significantly below the critical threshold of 40%. A loss of 70% of mass during the production of 'teri_grade_a' indicates severe issues with raw material quality, processing waste, weighing errors, or potential theft."
}
```

### transactions/mQ5CLzv6iqxRXyb9dQEI
```json
{
  "type": "TRANSPORT",
  "locationId": "kaimana",
  "unitId": "gudang_ikan_teri",
  "targetLocationId": "jakarta",
  "targetUnitId": "office",
  "itemId": "teri_grade_a",
  "quantityKg": 150,
  "freightCost": 500000,
  "description": "Sim Day 3 TRN",
  "totalAmount": 500000,
  "serialNumber": "TRN-KAI-26-0003",
  "timestamp": "2026-02-02T22:21:03.124Z",
  "serverTimestamp": "2026-02-02T22:21:03.124Z",
  "userId": "SYSTEM",
  "finalized": true,
  "skipAudit": false,
  "ai_risk_score": 6,
  "risk_score": 6,
  "auditStatus": "FLAGGED",
  "ai_analysis": "Operational anomaly detected. The destination targetUnitId is set to 'office' in Jakarta. Sending 150kg of 'teri_grade_a' (inventory) to an administrative office is highly irregular and likely a data entry error, as offices lack warehouse capabilities. Additionally, the freight cost of 500,000 IDR (approx 3,333 IDR/kg) for Kaimana-Jakarta transport is significantly below standard market logistics rates."
}
```

### transactions/BnxML7eG6yYMh80az03H
```json
{
  "type": "EXPENSE",
  "locationId": "kaimana",
  "unitId": "gudang_ikan_teri",
  "amount": 250000,
  "paymentMethod": "cash",
  "description": "Sim Day 4 Electricity",
  "totalAmount": 250000,
  "serialNumber": "EXP-KAI-26-0001",
  "timestamp": "2026-02-02T22:21:05.228Z",
  "serverTimestamp": "2026-02-02T22:21:05.228Z",
  "userId": "SYSTEM",
  "finalized": true,
  "skipAudit": false,
  "ai_risk_score": 1,
  "risk_score": 1,
  "auditStatus": "CLEARED",
  "ai_analysis": "Routine utility expense generated by system automation. The amount (250,000 IDR) represents standard daily electricity costs for the Kaimana warehouse. It is significantly below the 5M IDR approval threshold and the 10M IDR cash suspicion limit. No anomalies detected."
}
```

### transactions/qWEMuZQa6PJUG4S6a4v2
```json
{
  "type": "LOCAL_SALE",
  "locationId": "jakarta",
  "unitId": "office",
  "itemId": "teri_grade_a",
  "gradeId": "NA",
  "quantityKg": 50,
  "pricePerKg": 150000,
  "description": "Sim Day 5 SLD",
  "totalAmount": 7500000,
  "serialNumber": "SLD-JAK-26-0001",
  "timestamp": "2026-02-02T22:21:06.811Z",
  "serverTimestamp": "2026-02-02T22:21:06.811Z",
  "userId": "SYSTEM",
  "finalized": true,
  "skipAudit": false,
  "ai_risk_score": 1,
  "risk_score": 1,
  "auditStatus": "CLEARED",
  "ai_analysis": "Transaction represents a standard local sale of premium inventory (Teri Grade A). The unit price of 150,000 IDR/kg is healthy and consistent with market rates for Grade A quality. The total amount (7.5M IDR) is below the suspicious cash threshold (10M IDR). This is a revenue-generating event, so expense approval limits do not apply."
}
```

### transactions/cWJO6my714jWDPzwK0mM
```json
{
  "type": "CASH_TRANSFER",
  "locationId": "kaimana",
  "unitId": "gudang_ikan_teri",
  "transferDirection": "IN",
  "amount": 10000000,
  "description": "Sim Day 6 Replenish",
  "totalAmount": 10000000,
  "serialNumber": "TXF-KAI-26-0001",
  "timestamp": "2026-02-02T22:21:08.323Z",
  "serverTimestamp": "2026-02-02T22:21:08.323Z",
  "userId": "SYSTEM",
  "finalized": true,
  "skipAudit": false,
  "ai_risk_score": 1,
  "risk_score": 1,
  "auditStatus": "CLEARED",
  "ai_analysis": "Routine system-generated cash replenishment (Capital Injection) for simulation Day 6. Transaction is a 'Transfer IN', not an expense or external payment. While the amount hits the 10M IDR threshold, it is an internal allocation by the SYSTEM user to fund operations at the Kaimana Anchovy Warehouse, posing no financial risk."
}
```

## 2) Stock Proof

### locations/kaimana/units/gudang_ikan_teri/stock/COLD_teri_grade_a_NA
```json
{
  "grade": "NA",
  "quantityKg": 0,
  "updatedAt": "2026-02-02T22:21:03.124Z"
}
```

### locations/jakarta/units/office/stock/COLD_teri_grade_a_NA
```json
{
  "grade": "NA",
  "quantityKg": 100,
  "updatedAt": "2026-02-02T22:21:06.811Z"
}
```

## 3) Wallet Proof

### site_wallets/kaimana_gudang_ikan_teri
```json
{
  "balance": 54250000,
  "updatedAt": "2026-02-02T22:21:10.414Z"
}
```

### site_wallets/jakarta_office
```json
{
  "balance": 7500000,
  "updatedAt": "2026-02-02T22:21:08.578Z"
}
```

## 4) Idempotency Proof (TRANSPORT)
- **Guard Condition**: All operations are wrapped in `db.runTransaction` in `transaction_engine.js`.
- **State Locking**: The `finalized: true` field is set on the `transactions/{id}` document inside the atomic block. Any retry would fail if the unique ID is already present or if the transactional read of stock/wallet fails consistency checks.
- **Stock/Wallet Guard**: In `TRANSPORT`, both source and target stock references are read (`t.get`) before any write is performed, ensuring the total kg balance is maintained and never double-debited.

